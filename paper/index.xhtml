<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
	<title>From SVG to Canvas and Back</title>
	<meta name="description" content="Abstract of the presentation"/>
	<meta name="keywords" content="conference proceedings, keywords of the presentation"/>
	<style type="text/css">
		.fail { color: orange; }
		.comment { color: gray; }
	</style>
</head>
<body>
	<div class="article" lang="en">
		<div class="titlepage">
	  		<div>
	   			<div>
	    			<h2 class="title"><a id="d4e1"/>From SVG to Canvas and Back</h2>
				</div>

	   			<!--<h3 class="subtitle"><i>Here is the subtitle</i></h3> -->
	   
			</div>
	   		<div>
		    	<div class="authorgroup">
					<div class="author"><h3 class="author"><span class="firstname">Samuli</span> <span class="surname">Kaipiainen</span></h3>
			 			<div class="personblurb"><p>University of Helsinki, Department of Computer Science<br/>samuli.kaipiainen@cs.helsinki.fi</p></div>
				 	</div>
				 	<div class="author"><h3 class="author"><span class="firstname">Matti</span> <span class="surname">Paksula</span></h3>
			 	  		<div class="personblurb"><p>Member of W3C SVG Interest Group<br/><br/>University of Helsinki, Department of Computer Science<br/>matti.paksula@cs.helsinki.fi</p></div>
				 	</div>
					<br/>
	                <span class="org">
	                    <span class="orgname">University of Helsinki</span><br/>
	                    <span class="orgdiv">Department of Computer Science</span>

	                    <div class="address"><p>
	                        <span class="street">Gustaf Hällströmin katu 2b</span><br/>
	                        <span class="postcode">00014 University of Helsinki</span><br/>
	                        <span class="city">Helsinki</span><br/>

	                        <span class="country">Finland</span><br/>

<br/>
	                    </p></div>
	                </span>

				</div>
			</div>
	   
			<div>
		    	<div class="abstract">
					<hr/>
					<p class="title"><b>Abstract</b></p>
					<hr/>
					<p>In this paper we continue our previous work that was published at SVG Open 2009.  We identify requirements for using SVG and Canvas effectively by using a trivial drawing application as a starting point.  We will show that using browsers native rendering of SVG can be directly used as a bitmap export of SVG.  This method has security issues that are briefly explained.  Based on the feature requirements and security evaluation, we propose an API method for SVG elements that resembles the <code>toDataURL()</code>-method of Canvas. In addition, we propose a list of enhancements for browser manufacturers that were gathered during this work.  Lastly, we list and evaluate SVG compatibility workarounds and combine everything that was presented in this paper to an interactive demonstration page.</p>
				</div>
		   </div>
		</div>
		<hr/>
	</div>

  <div class="toc"><p><b>Table of Contents TODO:check that it's final</b></p>
  	<dl>
  		<dt><span class="section"><a href="#introduction">Introduction</a></span></dt>
  		<dt><span class="section"><a href="#motivation">Motivation: Complete Drawing Application</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#requirements">Requirements for a Web Based Drawing Application</a></span></dt>
			</dl>
  		</dd>
  		<dt><span class="section"><a href="#implementations">Our Implementations</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#canvas_to_svg">Canvas to SVG</a></span></dt>
  				<dt><span class="section"><a href="#svg_to_canvas">SVG to Canvas</a></span></dt>
  				<dt><span class="section"><a href="#browser_compatibility">Browser Compatibility</a></span></dt>
			</dl>
  		</dd>

  		<dt><span class="section"><a href="#security_issues">Security Issues</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#same_origin">Same Origin and Canvas Origin Policy</a></span></dt>
  				<dt><span class="section"><a href="#experimenting">Experimenting with Origin-Clean and Canvas</a></span></dt>
			</dl>
  		</dd>

  		<dt><span class="section"><a href="#recommendations">Recommendations</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#svg_to_dataurl_api">SVG.toDataURL() API</a></span></dt>
  				<dt><span class="section"><a href="#browser_manufacturers">For Browser Manufacturers</a></span></dt>
			</dl>
  		</dd>

  		<dt><span class="section"><a href="#workarounds">SVG Compatibility Workarounds</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#canvas_implementations">Implementations with Canvas</a></span></dt>
  				<dt><span class="section"><a href="#flash_implementations">Implementations with Flash</a></span></dt>
  				<dt><span class="section"><a href="#workaround_problems">Problems with Workarounds</a></span></dt>
			</dl>
  		</dd>

  		<dt><span class="section"><a href="#guideline">Guideline for Drawing Application Technologies</a></span></dt>
  		<dd>
  			<dl>
  				<dt><span class="section"><a href="#guideline_demonstration">Guideline and the Demonstration Page</a></span></dt>
  				<dt><span class="section"><a href="#guideline_evaluation">Guideline Evaluation</a></span></dt>
			</dl>
  		</dd>

  		<dt><span class="section"><a href="#conclusions">Conclusions</a></span></dt>

		<dt><span class="bibliography"><a href="#Biblio">Bibliography</a></span></dt>
  	</dl>
  </div>


	
	
	
	
	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="introduction"/>
						Introduction
					</h2>
				</div>
			</div>
		</div>
		
		<p>At <a href="http://svgopen.org/2009/">SVG Open 2009</a> we presented a method of using the bitmap content of Canvas element in SVG as an image element.  This was done by utilizing <code>canvas.toDataURL()</code>-method that returns a base64-coded pixel representation of the canvas drawing context as a PNG image.  This data URI can be set as source for a SVG Image element.  In our demonstration we combined the best parts of SVG (vector drawing, native scene graph support) and Canvas (pixel drawing) in one trivial drawing application.  SVG to Canvas transfer was done in server-side, by rasterizing the image and then drawing that on a canvas element [<a class="xref" href="#TRIVIAL09">TRIVIAL09</a>].</p>
		
		<p>As the method for transferring Canvas to SVG was native in the browser (<code>toDataURL()</code>), the next step is obviously to do the same for SVG to Canvas instead of server-side conversion.  It would be tempting to use browsers native rendering, but unfortunately SVG does not support a <code>toDataURL()</code>-method.  There has been <a href="http://lists.w3.org/Archives/Public/public-svg-ig/2009OctDec/0004.html">some</a> <a href="http://lists.w3.org/Archives/Public/www-svg/2009Oct/0003.html">discussion</a> about adding same method to SVG, but this has some serious security issues that will be discussed in the "<a href="#security_issues">Security Issues</a>" section of this paper.</p>
		
		<p>In this paper we will show an experimental method for using the browsers native rendering support to render SVG on Canvas.  We will also present a complete list of the possible methods for using SVG together with Canvas.  Evaluation of these methods and application fits is also given.  In addition, we present a list of recommendations for browser manufacturers to implement for improved support and adaptation of SVG and Canvas.</p>
		
	</div>


	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="motivation"/>
						Motivation: Complete Drawing Application
					</h2>
				</div>
			</div>
		</div>
		
		<p>Like in the paper we published last year, our motivation is drawing in the web: using the right techniques for the right things. (See "<a href="http://svgopen.org/2009/papers/54-SVG_vs_Canvas_on_Trivial_Drawing_Application/#d4e250">Combining existing components: SVG-Edit and CanvasPaint</a>")</p>
		
		<p>The need for interface between SVG and canvas is real and really required for efficent adaptation of SVG.  For example, SVG-edits <a href="http://code.google.com/p/svg-edit/issues/detail?id=70">issue #70</a>, "ability to save canvas as PNG" is currently solved with JavaScript+Canvas rendering workaround although a native implementation would be better [<a class="xref" href="#ISSUE70">ISSUE70</a>]. A list of rendering workarounds is given the "<a href="#workarounds">SVG Compatibility Workarounds</a>" section of this paper.</p>
		
		<h3 class="title">
			<a id="requirements"/>
			Requirements for a Web Based Drawing Application
		</h3>

		<p>The following list shows requirements for a completely web based drawing application.  This list does not apply only for drawing applications: if every requirement would be supported natively by the browsers, it would make the adaptation of SVG and Canvas more popular.</p>

		<div class="itemizedlist">
			<ol>	
				<li><p>Pixel drawing</p></li>
				<li><p>Vector drawing</p></li>
				<li><p>Interfaces</p>
					<ol>
						<li style="list-style-type: lower-alpha"><p>Bitmap export and import (Canvas to SVG)</p></li>
						<li style="list-style-type: lower-alpha"><p>Vector rasterization and import (SVG to Canvas)</p></li>					
					</ol>
				</li>
				<li><p>Exporting</p>
					<ol>
						<li style="list-style-type: lower-alpha"><p>Export vectors (SVG DOM)</p></li>
						<li style="list-style-type: lower-alpha"><p>Export bitmap (Canvas bitmap)</p></li>					
					</ol>
				</li>
			</ol>
		</div>

		<p>Previous work shows the best technology fit for the requirements 1, 2 and 3.a, but used server-side rendering for 3.b requiring additional components.  In the next section we show and evaluate a method to use browsers native rendering of SVG to rasterize image in order to solve the interface requirement 3.b and exporting of rasterized image requirement 4.b.</p>
	</div>
	
	
	

	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="implementations"/>
						Our Implementations
					</h2>
				</div>
			</div>
		</div>
		
		<p>Following two methods allow native, two-way interaction with SVG and Canvas.  A proposal for better and standardized implementation for SVG to Canvas is given in the "<a href="#recommendations">Recommendations</a>" section of this paper after the security issues associated with it are presented.</p>
		
		<h3 class="title">
			<a id="canvas_to_svg"/>
			Canvas to SVG
		</h3>
		
		<p>This method we presented last year [<a class="xref" href="#TRIVIAL09">TRIVIAL09</a>] and is provided here for completeness.</p>
		  
<pre class="programlisting">function <strong>importCanvas</strong>(sourceCanvas, targetSVG) {
    var img_dataurl = sourceCanvas.<strong>toDataURL</strong>("image/png");
    var svg_img = document.createElementNS(
        "http://www.w3.org/2000/svg", "image");

    svg_img.setAttributeNS(
        "http://www.w3.org/1999/xlink", "xlink:href", img_dataurl);

    targetSVG.appendChild(svg_img);
}
</pre>
	
		<p>TODO: Could not get comments to be parsed in XML ?, need to write short overview.</p>
		
				
		<h3 class="title">
			<a id="svg_to_canvas"/>
			SVG to Canvas
		</h3>

		<p>The idea for our "SVG to Canvas" method is to make use of the web browser rendering of SVG.  As the SVG is rasterized in the screen, it should be possible to use those pixels directly in Canvas.  However, no direct interface exists (yes, see our SVG.toDataURL() API recommendation in section "<a href="#recommendations">Recommendations</a>"), so we’ll use Canvas for the job.</p>

<pre class="programlisting">function <strong>importSVG</strong>(sourceSVG, targetCanvas) {
   <span class="comment">// https://developer.mozilla.org/en/XMLSerializer</span>
   svg_xml = (new XMLSerializer()).<strong>serializeToString</strong>(sourceSVG);
   var ctx = targetCanvas.getContext('2d');

   <span class="comment">// this is just a JavaScript (HTML) image</span>
   var img = new Image();
   <span class="comment">// http://en.wikipedia.org/wiki/SVG#Native_support</span>
   <span class="comment">// https://developer.mozilla.org/en/DOM/window.btoa</span>
   img.src = "data:<strong>image/svg+xml</strong>;base64," + btoa(svg_xml);

   img.onload = function() {
       <span class="comment">// after this, Canvas’ origin-clean is DIRTY</span>
       ctx.<strong>drawImage</strong>(img, 0, 0);
   }
}
</pre>

		<p>Web browsers only expose the SVG data in DOM, which can also be serialized to XML.  We used this in your last years implementation where we sent the serialized XML to server-side rasterizer, which returned a PNG image (with transparency).</p>

		<p>Canvas allows to draw arbitrary images on it via the <code>drawImage</code>-function.  The Canvas specification for <code>drawImage()</code> says: "The image argument is an instance of either HTMLImageElement, HTMLCanvasElement, or HTMLVideoElement."  So any image that the browser supports, can be drawn on Canvas [<a class="xref" href="#CANVAS10">CANVAS10</a>].</p>

		<p>All browsers support images with data URI [<a class="xref" href="#RFC2397">RFC2397</a>].  Currently, some browsers (Webkit) support SVG images as source for <code>img</code> elements [<a class="xref" href="#SVGimg10">SVGimg10</a>].  By combining these, we can transfer the serialized XML SVG data into a HTML Image element.  This HTML Image element can be used as an argument for the <code>drawImage()</code>-method of Canvas.</p>

		<p>Currently (2010-08) this only works in Safari and Chrome.  Also, the "SVG to Canvas" transfer is write-only, as it triggers the <code>origin-clean</code> flag of Canvas as dirty, which causes that Canvas to be unreadable (until reloaded and cleared). This security issue will be discussed in the "<a href="#security_issues">Security Issues</a>" section.</p>

		<h3 class="title">
			<a id="browser_compatibility"/>
			Browser Compatibility
		</h3>

		<p>Support for the techniques used in the "Canvas to SVG" method are better and more consistent than for the "SVG to Canvas" methods, as can be seen from the table below.</p>
		
		<table width="80%">
			<caption>Table 1: Browser compatibility for Canvas-SVG interaction</caption>
			<thead>
				<tr>
					<th>Quirk / Browser</th>
					<th>Safari 4.1 (Webkit)</th>
					<th>Chrome TODO.TODO (Webkit)</th>
					<th>Firefox 3.6.x</th>
					<th>Opera 10.x.x (TODO?)</th>
					<th>IE 9 Preview xxxx TODO</th>
				</tr>
			</thead>
			
			<tbody>
				<tr>
					<td>XML-serialize dynamic SVG data</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td class="fail">fail</td>
				</tr>

				<tr>
					<td>Data URL in HTML <code>img</code> element</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
				</tr>

				<tr>
					<td>SVG Image in HTML <code>img</code> element</td>
					<td>ok</td>
					<td>ok</td>
					<td class="fail">fail</td>
					<td class="fail">only static?</td>
					<td></td>
				</tr>

				<tr>
					<td>Non-standard <code>btoa()</code> base64 function</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td></td>
				</tr>

				<tr>
					<td>SVG data URL for Canvas <code>drawImage</code></td>
					<td>ok</td>
					<td>ok</td>
					<td class="fail">fail</td>
					<td class="fail">fail</td>
					<td></td>
				</tr>

				<tr>
					<td>...above should set <code>origin-clean</code> as dirty</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td></td>
				</tr>

				<tr>
					<td>Canvas.<code>toDataURL()</code></td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
					<td>ok</td>
				</tr>

				<tr>
					<td>extra: Right-click on Canvas allows "Save as.."</td>
					<td class="fail">not</td>
					<td class="fail">not</td>
					<td>ok</td>
					<td class="fail">not</td>
					<td>TODO</td>
				</tr>

			</tbody>
		</table>
	</div>
	
	
	
	
	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="security_issues"/>
						Security Issues
					</h2>
				</div>
			</div>
		</div>
		
		<p>Our "SVG to Canvas" approach has a security issue that could, however, be avoided as we argue in our <code>SVG.toDataURL()</code> proposal.</p>
			
		<h3 class="title">
			<a id="same_origin"/>
			Same Origin and Canvas Origin Policy
		</h3>

		<p>Web pages are composed of different elements coming from different origins.  Elements coming from the <em><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/origin-0.html#same-origin">same</a></em> origin are considered to be safe [<a class="xref" href="#Origin10">Origin10</a>].</p>
		
		<p>Canvas has powerful image reading and writing capabilities.  It would be trivial to use canvas as middleman for transfering a local image to a third-party just by loading image into Canvas element from <code>file://</code> -URL and then sending the pixel data from the Canvas element to any host with JavaScript.</p>
		
		<p>To prevent information leakage with Canvas, browsers are carefully protecting the usage of Canvas when the source for image data is not safe.  All Canvas elements are created as their origin-clean attribute set to <em>true</em>. When any of the actions that may potentially be used for using Canvas element to transfer content that violates the same origin policy, the <em>origin-clean</em> property is permanently set to <em>false</em>.</p>

		<p>If methods that return the pixel data stored in canvas, such as <code>toDataURL()</code> or <code>getImageData()</code>, are called on the Canvas element whose origin-clean is <em>false</em>, then a <code><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#security-with-canvas-elements">DOMException 18, SECURITY_ERR</a></code> is raised [<a class="xref" href="#Canvas10">Canvas10</a>].</p>
		
		
		<h3 class="title">
			<a id="experimenting"/>
			Experimenting with Origin-Clean and Canvas
		</h3>

		<p>To get better understanding of origin-clean behaviour, we evaluated following cases.</p>
		
		<h4>PNG and <code>drawImage()</code></h4>

		<p>We test following two trivial cases first:</p>
		
		<p><strong>Case 1a:</strong> load a PNG image to the DOM, draw that on Canvas element with <code>drawImage()</code>-method.</p>

		<p><strong>Case 1b:</strong> load a PNG image to the DOM, create an instance of JavaScript <code>Image</code>-object and draw that on Canvas element with <code>drawImage()</code>-method</p>

		<p>In <em>1a</em> and <em>1b</em>, the Canvas element stays origin-clean as expected.  JavaScript <code>Image</code>-object, as long as the MIME type is <code>image/png</code> works also.  It seems like all MIME types other than <code>image/svg+xml</code> works this way.</p>

		<p><strong>Case 1c:</strong> Load an image from local <code>file://</code>-URL and display it on HTML document loaded from <code>file://</code>-URL.  Then draw that image on Canvas element with <code>drawImage()</code>-method.</p>

		<p>In <em>1c</em> the Canvas element is not origin-clean.  No data can be exported from Canvas, any attempts will cause a <code>SECURITY_ERR</code> exception. This the standard behavior that was <a href="https://developer.mozilla.org/En/Same-origin_policy_for_file:_URIs">changed lately</a> in all browsers, like in Mozilla Gecko [<a class="xref" href="#MozillaSameOrigin">MozillaSameOrigin</a>].</p>
		
		
		<h4>PNG as Data URI</h4>
		
		<p>When a PNG is represented as data URI so that <code>img</code>-elements source attribute is set to data URI: <code>img.src = "data:image/png;base64,iVBORw0..."</code> and this <code>img</code>-element is rendered on Canvas with <code>drawImage()</code>-method, the canvas stays origin-clean.</p>
		
		
		<h4>SVG to Canvas</h4>
		
		<p>If the source attribute of HTML <code>img</code>-element is set to "shapes.svg", and this image element is rendered on Canvas element, the origin-clean is set to <em>false</em> even if same origin policy should be satisfied.</p>
		
		<h4>SVG as Data URI</h4>
		
		<p>If the SVG is represented as a data URI: <code>"data:image/svg+xml;base64,dVAx..."</code> and this string is set as source attribute of a HTML image, which is then rendered on Canvas element, the origin-clean sets to <em>false</em>.</p>
		
		
		
		<h4>SVG with Safe Elements</h4>
		
		<p>This testing becomes more interesting if we do the same tests with a SVG that uses only safe elements, such as <code>&lt;rect&gt;</code> and <code>&lt;circle&gt;</code>.  Result will be that the Canvas origin-clean property sets permanently to <em>false</em>, even if all the elements can be considered as "safe" and <em>same</em> origin.</p>


		<h3 class="title">
			<a id="svg_conclusions"/>
			Conclusions on SVG Security Issues
		</h3>
		
		<p>So, why SVG is dangerous?  SVG can potentially contain content from multiple origins and browsers tend to blacklist any content with the MIME type <code>image/svg+xml</code> as multi-origin content without even testing the actual content.  A good summary of this is given in the comments of Webkit bug #29305 "<a href="https://bugs.webkit.org/show_bug.cgi?id=29305#c1">Canvas drawn with data URL image raises SECURITY_ERR when toDataUrl() called.</a>" on why browser needs to consider SVG as multi-origin content.</p>
		
		<p>SVG that contains only safe and same origin elements should however be rendered to make allow efficent use of SVG with Canvas.  In the next section we propose a recommendation for a <code>SVG.toDataURL()</code>-method that allows bitmap export of the vector elements in SVG.</p>
		
	</div>
	
	
	
	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="recommendations"/>
						Recommendations
					</h2>
				</div>
			</div>
		</div>
		
		
		<h3 class="title">
			<a id="svg_to_dataurl_api"/>
			SVG.toDataURL() API
		</h3>
		
		<p>Based on the use cases stated in the requirements for a complete drawing application in the web and the security discussion, we propose a following API to allow exporting of the bitmap content of the SVG.</p>

<pre class="programlisting">SVG.toDataURL( [<abbr title="MIME type of the exported data">type</abbr>], [<abbr title="Export non-safe (image and foreignObject) elements">keepNonSafe</abbr>=false], [<abbr title="Export all drawn content, even if not visible.">keepOutsideViewport</abbr>=false] )
</pre>

		<dl>
			<dt><dfn is="type">type</dfn></dt>
			<dd>MIME type of the exported data.</dd>
			<dd>Default: <code>image/svg+xml</code>.</dd>
			<dd>Must support: <code>image/png</code>.</dd>

			<dt><dfn is="keepNonSafe">keepNonSafe</dfn></dt>
			<dd>Export non-safe (image and foreignObject) elements and set the Canvas <code>origin-clean</code> property to <em>false</em>.</dd>
			<dd>Default: <code>false</code> (to keep origin-clean true)</dd>
			
			<dt><dfn is="keepOutsideViewport">keepOutsideViewport</dfn></dt>
			<dd>Export all drawn content, even if not visible.</dd>
			<dd>Default: <code>false</code>, export only visible viewport, similar to Canvas <code>toDataURL()</code></dd>
			

		</dl>


		
		<h3 class="title">
			<a id="browser_manufacturers"/>
			For Browser Manufacturers
		</h3>
		
			<p>In addition to <code>SVG.toDataURL()</code>-method presented above, we would like to see following improvments in browsers.</p>
			
			<h4>Safari, Chrome (Webkit) and Opera</h4>
			
			<p>Clicking Canvas with right-click should prompt for "save as" (PNG).  This is the easiest way to export anything that has been drawn on Canvas.</p>
			
			<h4>Firefox</h4>
			
			<p>Support for SVG files as source for <code>img</code>-element.</p>
			
			<h4>Opera</h4>
			<p>Fix dynamic SVG in <code>img</code>-element support, what ever that means (TODO)</p>
			
			<h4>Internet Explorer</h4>
			
			<p>XMLSerializer (<a href="https://developer.mozilla.org/en/XMLSerializer">XMLSerializer</a>) is needed for the browser.</p>
			

	</div>



	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="workarounds"/>
						SVG Compatibility Workarounds
					</h2>
				</div>
			</div>
		</div>
		
		<p>SVG 1.1 recommendation is seven years old, but still not very well supported [<a class="xref" href="#SvgSupport">SvgSupport</a>]. Good statistics on SVG support can be seen at <a href="http://www.codedread.com/svg-support.php">http://www.codedread.com/svg-support.php</a>.  To address the lacking support for SVG and the security issue presented above, a great number of projects has spawned trying to implement SVG rendering with other technologies.</p>
		
		<p>Alternative technologies to render SVG are Canvas, Flash and VML. In the following list we have tried to gather all compatibility workarounds and other related projects of this field.  At the end of this section some notes on problems associated with the workarounds are given.</p>
		
		
		<h4>CanVG</h4>
		
		<p><a href="http://code.google.com/p/canvg/">http://code.google.com/p/canvg/</a></p>
		
		<p>CanVG is the most feature complete SVG compatibility JavaScript library for browsers that support Canvas. The projects end goal is to support everything in the SVG specification. And currently CanVG is selected for the SVG-Edit to solve SVG rasterization.  We will evaluate the usage of CanVG later in this paper.</p>

		<h4>SVG Web</h4>
		
		<p><a href="http://code.google.com/p/svgweb/">http://code.google.com/p/svgweb/</a></p>
		
		<p>SVG Web renders SVG files with Adobe Flash.  At the time of writing it supports ~50% of the SVG 1.1 specification [<a class="xref" href="#SvgSupport">SvgSupport</a>].</p>
		
		
			
		<h4>CakeJS</h4>
		
		<p><a href="http://code.google.com/p/cakejs/wiki/Documentation#SVGParser">http://code.google.com/p/cakejs/wiki/Documentation#SVGParser</a></p>
		
		<p>The Canvas Animation JavaScript library CakeJS has implemented SVG parser that converts SVG DOM to its own set of drawing commands that can be used to rasterize and animate SVG elements on Canvas.</p>


		<h4>Raphaël, Dojox.gfx and SVGKit SVGCanvas</h4>

		<p><a href="http://raphaeljs.com/">http://raphaeljs.com/</a><br/>
			<a href="http://docs.dojocampus.org/dojox/gfx">http://docs.dojocampus.org/dojox/gfx</a><br/>
			<a href="http://svgkit.sourceforge.net/SVGCanvas.html">http://svgkit.sourceforge.net/SVGCanvas.html</a></p>
		
		<p>Raphaël and dojox.gfx do not implement SVG compatibility, but rather provide own API that can be used for drawing vector graphics.  Raphaël is a JavaScript library that provides Canvas like API for drawing graphics.  It uses SVG for drawing graphics and falls back to VML if the browser does not support SVG).</p>
		
		<p>Dojox.gfx is an extension to the Dojo toolkit that similary to Raphaël uses SVG and VML, but also Silverlight and Canvas for drawing vector graphics.</p>
		
		<p>SVGKits SVGCanvas is also mentioned, because it provides Canvas API implementation that is rendered with SVG.</p>



		<h4>Flanvas</h4>
		
		<p><a href="http://flanvas.com/">http://flanvas.com/</a></p>

		<p>"Flanvas provides a way of interactive development similar to flex. The hope is that actionscript developers will find this to be an easy solution to use when flash is either too much, or not available."</p>
		
		<p>Flanvas parses SVG files and creates own representation of them that can be animated.  Support for SVG is still limited.</p>


		<h4>Abandoned CanvaSVG</h4>
		
		<p><a href="http://web.archive.org/web/20070928172356/http%3a//fuchsia-design.com/CanvaSVG/">http://web.archive.org/web/20070928172356/http%3a//fuchsia-design.com/CanvaSVG/</a></p>
		
		<p>In order this listing to be more or less complete, it’s important to include already abandoned hack project to stress the fact that Canvas is very lucrative platform for developers to start implementing SVG support.</p>

		<h4>PNG Rasterization</h4>
		
		<p>Static SVGs can also be rasterized as PNG images that are displayed instead of the SVG files.  This allows modifications still to be done on SVGs while providing full browser support. Wikipedia uses this technique to display their great amount of SVG images: <a href="http://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Butterfly.svg/398px-Butterfly.svg.png">http://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Butterfly.svg/398px-Butterfly.svg.png</a>.</p>
		
		
		<h3 class="title">
			<a id="workaround_problems"/>
			Problems with Workarounds
		</h3>
		
		<p>There should not be any need to re-implement, but while native rendering support is missing, the following aspects should be considered.</p>
		
		<h4>Scene Graph is Missing with Canvas</h4>
		
		<p>In order to have interactivity with "vectorized" elements on Canvas, the implementation needs to keep track of the elements, their boundaries and ordering.  This brings some overhead as discussed in our previous paper [<a class="xref" href="#TRIVIAL09">TRIVIAL09</a>].</p>

		<h4>Accessibility</h4>
		
		<p>More important than scene graph is the accessibility of the web.  Especially with workaround solutions where the source is not available as SVG, but only as a non-accessible bitmap the accessibility is very limited.</p>

		<h4>Speed and Complexity</h4>
		
		<p>Not only the full support of SVG is quite complex task to complete with JavaScript and Canvas or Flash, but it is also more likely to be slower than a native implementation.</p>
	
		
	</div>
	
	


	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="guideline"/>
						Guideline for Drawing Application Technologies 
					</h2>
				</div>
			</div>
		</div>
		
		<p>Based on the requirements stated above, here is our list of implementation recommendations for the current state of technologies. This is due to change in future, when better solutions become available.</p>

		<h3 class="title">
			<a id="guideline_demonstration"/>
			Guideline and the Demonstration Page
		</h3>

		<p>See our demonstration page. TODO.</p>
		
		<p>Our demonstration page shows a list of feature requirements for a complete drawing application with SVG and Canvas. Each of the requirements are implemented with most suitable methods.  As the method used might effect on the other methods (by making them no longer available for security reasons), the page shows the effects: if a method is no longer available, it is rendered as TODO in the feature list.  Refreshing the page resets the status.</p>
		
		
		<h3 class="title">
			<a id="guideline_evaluation"/>
			Guideline Evaluation
		</h3>

		<p>If any TODO</p>
		
	</div>
	
	<div class="section" lang="en">
		<div class="titlepage">
			<div>
				<div>
					<h2 class="title" style="clear: both">
						<a id="conclusions"/>
						Conclusions</h2>						
				</div>
			</div>
		</div>
		

		<p>The future web that is based on open web standards is not complete without fully supported vector graphics. Since the last SVG Open 2009, the popularity of SVG has not raised, but the support has become better, especially with the latest Internet Explorer 9 preview releases.</p>

		<p>The list of compatibility libraries in this paper show that SVG a) SVG rendering support has to get better, and more interestingly  b) the interaction with different technologies, like Canvas needs to improve as well.  If browsers would support better interaction with SVG, with such features as our proposed <code>toDataURL()</code>-method, it would make SVG less isolated.  As SVG has powerful features, the security issues that come with SVG need to be understood. The current security model is too thight for effective interaction with SVG.</p>
	
	</div>
	
		


			<div class="bibliography">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title">
								<a id="Biblio"/>
								Bibliography
							</h2>
						</div>
					</div>
				</div>
				
				<div class="biblioentry">
					<a id="TRIVIAL09"/>
					<p>[<abbr class="abbrev">TRIVIAL09</abbr>] 
			
						<span class="author"><span class="firstname">Samuli</span> <span class="surname">Kaipiainen</span></span>
						and
						<span class="author"><span class="firstname">Matti</span> <span class="surname">Paksula</span></span>:
					
						<span class="title"><i>SVG vs Canvas on Trivial Drawing Application</i>. </span>
						<br/>
						<span class="publisher">
							<span class="publishername">Proceedings of the 7th International Conference on Scalable Vector Graphics</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://svgopen.org/2009/papers/54-SVG_vs_Canvas_on_Trivial_Drawing_Application/">http://svgopen.org/2009/papers/54-SVG_vs_Canvas_on_Trivial_Drawing_Application/</a>
						</span>

					</p>
				</div>

				<div class="biblioentry">
					<a id="ISSUE70"/>
					<p>[<abbr class="abbrev">ISSUE70</abbr>] 
								
						<span class="title"><i>SVG-Edit Issue #70: Ability to save canvas as PNG</i>. </span>
						<br/>
						<span class="publisher">
							<span class="publishername">SVG-Edit Project</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://code.google.com/p/svg-edit/issues/detail?id=70">http://code.google.com/p/svg-edit/issues/detail?id=70</a>
						</span>

					</p>
				</div>


				<div class="biblioentry">
					<a id="CANVAS10"/>
					<p>[<abbr class="abbrev">CANVAS10</abbr>] 
								
						<span class="title"><i>HTML5 Draft Standard 20: The canvas element</i>, August 2010.</span>
						<br/>
						<span class="publisher">
							<span class="publishername">Web Hypertext Application Technology Working Group</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html">http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html</a>
						</span>

					</p>
				</div>

				<div class="biblioentry">
					<a id="RFC2397"/>
					<p>[<abbr class="abbrev">RFC2397</abbr>] 
								
						<span class="title"><i>RFC2397 The "data" URL scheme</i>, August 1998.</span>
						<br/>
						<span class="publisher">
							<span class="publishername">The Internet Engineering Task Force (IETF)</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://www6.ietf.org/rfc/rfc2397.txt">http://www6.ietf.org/rfc/rfc2397.txt</a>
						</span>

					</p>
				</div>
			
				<div class="biblioentry">
					<a id="SVGimg10"/>
					<p>[<abbr class="abbrev">SVGimg10</abbr>] 
								
						<span class="title">Wikipedia <i>SVG: Native Support</i>.</span>
						<br/>
						<span class="url">
							<a href="http://en.wikipedia.org/wiki/SVG#Native_support">http://en.wikipedia.org/wiki/SVG#Native_support</a>
						</span>

					</p>
				</div>
				
				<div class="biblioentry">
					<a id="Origin10"/>
					<p>[<abbr class="abbrev">Origin10</abbr>] 
								
						<span class="title"><i>HTML5 Draft Standard 20: Origin</i>, August 2010.</span>
						<br/>
						<span class="publisher">
							<span class="publishername">Web Hypertext Application Technology Working Group</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/origin-0.html#same-origin">http://www.whatwg.org/specs/web-apps/current-work/multipage/origin-0.html#same-origin</a>
						</span>

					</p>
				</div>
				
				<div class="biblioentry">
					<a id="MozillaSameOrigin"/>
					<p>[<abbr class="abbrev">MozillaSameOrigin</abbr>] 
								
						<span class="title"><i>Same-origin policy for file: URIs</i></span>
						<br/>
						<span class="publisher">
							<span class="publishername">Mozilla Developer Center</span>
						</span>
						<br/>
						<span class="url">
							<a href="https://developer.mozilla.org/En/Same-origin_policy_for_file:_URIs">https://developer.mozilla.org/En/Same-origin_policy_for_file:_URIs</a></span>

					</p>
				</div>

				<div class="biblioentry">
					<a id="SvgSupport"/>
					<p>[<abbr class="abbrev">SvgSupport</abbr>] 
								
						<span class="title"><i>SVG Support tables</i></span>
						<br/>
						<span class="publisher">
							<span class="publishername">Codedread</span>
						</span>
						<br/>
						<span class="url">
							<a href="http://www.codedread.com/svg-support.php">http://www.codedread.com/svg-support.php</a></span>

					</p>
				</div>
				

							
			</div>

	</body>
</html>